// ==UserScript==
// @name         High Court Date Picker with Auto-Submit
// @namespace    http://tampermonkey.net/
// @version      0.5
// @description  Add date picker functionality to High Court of Punjab & Haryana website with auto-submit
// @match        *://10.145.22.11:8888/weed_catalogue.php*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';
    let selectedDate = '';

    function addDatePicker() {
        const dateButton = document.createElement('button');
        dateButton.innerHTML = 'ðŸ“…';
        dateButton.style.position = 'fixed';
        dateButton.style.top = '140px';
        dateButton.style.right = '10px';
        dateButton.style.zIndex = '9999';
        dateButton.onclick = toggleDatePicker;
        document.body.appendChild(dateButton);
    }

    function toggleDatePicker() {
        const existingPicker = document.getElementById('customDatePicker');
        if (existingPicker) {
            existingPicker.remove();
        } else {
            createDatePicker();
        }
    }

    function createDatePicker() {
        const picker = document.createElement('input');
        picker.type = 'date';
        picker.id = 'customDatePicker';
        picker.style.position = 'fixed';
        picker.style.top = '100px';
        picker.style.right = '10px';
        picker.style.zIndex = '10000';
        picker.onchange = updateDates;
        document.body.appendChild(picker);
        if (selectedDate) {
            picker.value = selectedDate;
        }
    }

    function updateDates(event) {
        const formattedDate = formatDate(event.target.value);
        selectedDate = event.target.value;

        // Target the correct input fields using the provided names
        const dateFromInput = document.querySelector('input[name="f_date"]');
        const dateToInput = document.querySelector('input[name="t_date"]');

        if (dateFromInput && dateToInput) {
            dateFromInput.value = formattedDate;
            dateToInput.value = formattedDate;

            // Trigger change event to ensure any listeners on the original inputs are notified
            triggerEvent(dateFromInput, 'change');
            triggerEvent(dateToInput, 'change');

            // Automatically click the Submit button
            clickSubmitButton();
        }
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
    }

    function triggerEvent(element, eventType) {
        const event = new Event(eventType, { bubbles: true });
        element.dispatchEvent(event);
    }

    function clickSubmitButton() {
        const submitButton = document.querySelector('.btn.btn-success');
        if (submitButton) {
            submitButton.click();
        }
    }

    addDatePicker();
})();
